C51 COMPILER V9.59.0.0   BLDC_SENSORLESS                                                   02/23/2019 10:47:23 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BLDC_SENSORLESS
OBJECT MODULE PLACED IN .\Objects\BLDC_Sensorless.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE BLDC_Sensorless.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\BLDC_Sensorless.lst) TABS(2) OBJECT(.\Objects\BLDC_Sensorless.obj)

line level    source

   1          #include <N76E003.h>
   2          #include <BLDC_Sensorless.h>
   3          
   4          unsigned int DCBUS_Voltage = 0;
   5          
   6          
   7          unsigned int Phase_U_Voltage_ADC_Value;
   8          unsigned int Phase_V_Voltage_ADC_Value;
   9          unsigned int Phase_W_Voltage_ADC_Value;
  10          
  11          
  12          void Set_Phase_U_Voltage_ADC_Value(unsigned int i)
  13          {
  14   1        Phase_U_Voltage_ADC_Value = i;
  15   1      }
  16          void Set_Phase_V_Voltage_ADC_Value(unsigned int i)
  17          {
  18   1        Phase_V_Voltage_ADC_Value = i;
  19   1      }
  20          void Set_Phase_W_Voltage_ADC_Value(unsigned int i)
  21          {
  22   1        Phase_W_Voltage_ADC_Value = i;
  23   1      }
  24          
  25          void BEMF_ReadVoltage(unsigned char phase) using 3
  26          {
  27   1        switch(phase)
  28   1        {
  29   2          case 1: ADCCON0 = 0X05; break;
  30   2          case 2: ADCCON0 = 0X04; break;
  31   2          case 3: ADCCON0 = 0X03; break;
  32   2        }
  33   1        ADCCON1 = 0X01;////
  34   1        ADCDLY = 0;
  35   1        ADCCON2 = 0x00;
  36   1        ADCCON0 |= 0X40;  //start adc
  37   1      }
  38          
  39          void Determine_BEMF_Detect_Channel(unsigned char eleccycle, unsigned char times) using 3
  40          {
  41   1        bit bemf_cmp = 0;
  42   1      
  43   1        switch(eleccycle)
  44   1        {
  45   2          case 1: {   
  46   3            switch(times)
  47   3            {
  48   4              case 1: BEMF_ReadVoltage(1); break;
  49   4              case 2: BEMF_ReadVoltage(3); break;
  50   4              case 3: 
  51   4                DCBUS_Voltage = Phase_U_Voltage_ADC_Value;
  52   4                bemf_cmp = Phase_W_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
  53   4                break;
  54   4            }
C51 COMPILER V9.59.0.0   BLDC_SENSORLESS                                                   02/23/2019 10:47:23 PAGE 2   

  55   3              break;  //AB c decrease  
  56   3          }
  57   2          case 2: {
  58   3            switch(times)
  59   3            {
  60   4              case 1: BEMF_ReadVoltage(1); break;
  61   4              case 2: BEMF_ReadVoltage(2); break;
  62   4              case 3: 
  63   4                DCBUS_Voltage = Phase_U_Voltage_ADC_Value;
  64   4                bemf_cmp = Phase_V_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
  65   4                break;
  66   4            }
  67   3              break;  //AC b increase
  68   3          }
  69   2          case 3: {
  70   3            switch(times)
  71   3            {
  72   4              case 1: BEMF_ReadVoltage(2); break;
  73   4              case 2: BEMF_ReadVoltage(3); break;
  74   4              case 3: 
  75   4                DCBUS_Voltage = Phase_V_Voltage_ADC_Value;
  76   4                bemf_cmp = Phase_U_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
  77   4                break;
  78   4            }
  79   3              break;  //BC a decrease
  80   3          }
  81   2          case 4: { 
  82   3            switch(times)
  83   3            {
  84   4              case 1: BEMF_ReadVoltage(2); break;
  85   4              case 2: BEMF_ReadVoltage(1); break;
  86   4              case 3: 
  87   4                DCBUS_Voltage = Phase_V_Voltage_ADC_Value;
  88   4                bemf_cmp = Phase_W_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
  89   4                break;
  90   4            }
  91   3              break;  //BA c increase
  92   3          }
  93   2          case 5: {
  94   3            switch(times)
  95   3            {
  96   4              case 1: BEMF_ReadVoltage(3); break;
  97   4              case 2: BEMF_ReadVoltage(1); break;
  98   4              case 3: 
  99   4                DCBUS_Voltage = Phase_W_Voltage_ADC_Value;
 100   4                bemf_cmp = Phase_V_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
 101   4                break;
 102   4            }
 103   3              break;  //CA b decrease
 104   3          }
 105   2          case 6: {
 106   3            switch(times)       
 107   3            {
 108   4              case 1: BEMF_ReadVoltage(3); break;
 109   4              case 2: BEMF_ReadVoltage(1); break;
 110   4              case 3: 
 111   4                DCBUS_Voltage = Phase_W_Voltage_ADC_Value;
 112   4                bemf_cmp = Phase_U_Voltage_ADC_Value < (DCBUS_Voltage >> 1);
 113   4                break;
 114   4            }
 115   3              break;  //CB a increase
 116   3          }
C51 COMPILER V9.59.0.0   BLDC_SENSORLESS                                                   02/23/2019 10:47:23 PAGE 3   

 117   2          case 0:
 118   2            break;
 119   2        }
 120   1        if(times == 3)
 121   1        P07 = bemf_cmp;
 122   1      } 
 123          
 124          void BEMF_Gpio_ADCIN_Init()
 125          {
 126   1        P0M1 |= 0x70;
 127   1        P0M2 &= 0x8f;
 128   1        AINDIDS  |= 0x38;
 129   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    433    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
