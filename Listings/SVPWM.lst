C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE SVPWM
OBJECT MODULE PLACED IN .\Objects\SVPWM.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE SVPWM.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\SVP
                    -WM.lst) TABS(2) OBJECT(.\Objects\SVPWM.obj)

line level    source

   1          #include "SVPWM.h"
   2          #include "3PhaseInverter.h"
   3          
   4          bit PhaseU_Target;
   5          bit PhaseV_Target;
   6          bit PhaseW_Target;
   7          
   8          sbit debug = P1^0;
   9          
  10          unsigned int T07,T1,T2;
  11          
  12          bit SVPFirstHalfSector;
  13          
  14          long Udcdvsqrt3, TSwitch,Udc;
  15          
  16          unsigned char SVPWMCurrentZone = 0;
  17          
  18          unsigned char sectornum ;
  19          unsigned char CurrentTargetVector = 0;
  20          unsigned char NextTargetVector = 0;
  21          
  22          unsigned int CurrentSVPSectorTime, NextSVPSectorTime;
  23          
  24          unsigned int code T1Array[]={222,
  25          219,217,215,212,210,
  26          207,204,202,199,196,
  27          193,190,187,184,181,
  28          178,175,171,168,165,
  29          161,158,154,150,147,
  30          143,139,136,132,128,
  31          124,120,116,112,108,
  32          104,100,96,92,88,
  33          83,79,75,71,66,
  34          62,58,53,49,44,
  35          40,36,31,27,22,
  36          18,13,9,4,0,
  37          4,9,13,18,22,
  38          27,31,36,40,44,
  39          49,53,58,62,66,
  40          71,75,79,83,88,
  41          92,96,100,104,108,
  42          112,116,120,124,128,
  43          132,136,139,143,147,
  44          150,154,158,161,165,
  45          168,171,175,178,181,
  46          184,187,190,193,196,
  47          199,202,204,207,210,
  48          212,215,217,219,222,
  49          219,217,215,212,210,
  50          207,204,202,199,196,
  51          193,190,187,184,181,
  52          178,175,171,168,165,
  53          161,158,154,150,147,
  54          143,139,136,132,128,
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 2   

  55          124,120,116,112,108,
  56          104,100,96,92,88,
  57          83,79,75,71,66,
  58          62,58,53,49,44,
  59          40,36,31,27,22,
  60          18,13,9,4,0,
  61          4,9,13,18,22,
  62          27,31,36,40,44,
  63          49,53,58,62,66,
  64          71,75,79,83,88,
  65          92,96,100,104,108,
  66          112,116,120,124,128,
  67          132,136,139,143,147,
  68          150,154,158,161,165,
  69          168,171,175,178,181,
  70          184,187,190,193,196,
  71          199,202,204,207,210,
  72          212,215,217,219,222,
  73          219,217,215,212,210,
  74          207,204,202,199,196,
  75          193,190,187,184,181,
  76          178,175,171,168,165,
  77          161,158,154,150,147,
  78          143,139,136,132,128,
  79          124,120,116,112,108,
  80          104,100,96,92,88,
  81          83,79,75,71,66,
  82          62,58,53,49,44,
  83          40,36,31,27,22,
  84          18,13,9,4,0,
  85          4,9,13,18,22,
  86          27,31,36,40,44,
  87          49,53,58,62,66,
  88          71,75,79,83,88,
  89          92,96,100,104,108,
  90          112,116,120,124,128,
  91          132,136,139,143,147,
  92          150,154,158,161,165,
  93          168,171,175,178,181,
  94          184,187,190,193,196,
  95          199,202,204,207,210,
  96          212,215,217,219,222
  97          };
  98          
  99          unsigned int code T2Array[]={0,
 100          4,9,13,18,22,
 101          27,31,36,40,44,
 102          49,53,58,62,66,
 103          71,75,79,83,88,
 104          92,96,100,104,108,
 105          112,116,120,124,128,
 106          132,136,139,143,147,
 107          150,154,158,161,165,
 108          168,171,175,178,181,
 109          184,187,190,193,196,
 110          199,202,204,207,210,
 111          212,215,217,219,222,
 112          219,217,215,212,210,
 113          207,204,202,199,196,
 114          193,190,187,184,181,
 115          178,175,171,168,165,
 116          161,158,154,150,147,
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 3   

 117          143,139,136,132,128,
 118          124,120,116,112,108,
 119          104,100,96,92,88,
 120          83,79,75,71,66,
 121          62,58,53,49,44,
 122          40,36,31,27,22,
 123          18,13,9,4,0,
 124          4,9,13,18,22,
 125          27,31,36,40,44,
 126          49,53,58,62,66,
 127          71,75,79,83,88,
 128          92,96,100,104,108,
 129          112,116,120,124,128,
 130          132,136,139,143,147,
 131          150,154,158,161,165,
 132          168,171,175,178,181,
 133          184,187,190,193,196,
 134          199,202,204,207,210,
 135          212,215,217,219,222,
 136          219,217,215,212,210,
 137          207,204,202,199,196,
 138          193,190,187,184,181,
 139          178,175,171,168,165,
 140          161,158,154,150,147,
 141          143,139,136,132,128,
 142          124,120,116,112,108,
 143          104,100,96,92,88,
 144          83,79,75,71,66,
 145          62,58,53,49,44,
 146          40,36,31,27,22,
 147          18,13,9,4,0,
 148          4,9,13,18,22,
 149          27,31,36,40,44,
 150          49,53,58,62,66,
 151          71,75,79,83,88,
 152          92,96,100,104,108,
 153          112,116,120,124,128,
 154          132,136,139,143,147,
 155          150,154,158,161,165,
 156          168,171,175,178,181,
 157          184,187,190,193,196,
 158          199,202,204,207,210,
 159          212,215,217,219,222,
 160          219,217,215,212,210,
 161          207,204,202,199,196,
 162          193,190,187,184,181,
 163          178,175,171,168,165,
 164          161,158,154,150,147,
 165          143,139,136,132,128,
 166          124,120,116,112,108,
 167          104,100,96,92,88,
 168          83,79,75,71,66,
 169          62,58,53,49,44,
 170          40,36,31,27,22,
 171          18,13,9,4,0,
 172          };
 173          
 174          
 175          void CalculateInverterVectorsWidth_Polar(unsigned int deg, unsigned int length)
 176          {
 177   1        length = length * 3 / 4;
 178   1        T1 = T1Array[deg] * length >> 5;
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 4   

 179   1        T2 = T2Array[deg] *length >> 5;
 180   1        T07 = (1536 - T1 - T2);
 181   1        if((deg >= 0) && (deg < 60))
 182   1        {
 183   2          sectornum = 1;
 184   2          SVPFirstHalfSector = deg > 30;
 185   2        }
 186   1        else if((deg >= 60) && (deg < 120))
 187   1        {
 188   2          sectornum = 2;
 189   2          SVPFirstHalfSector = deg < 90;
 190   2        }
 191   1        else if((deg >= 120) && (deg < 180))
 192   1        {
 193   2          sectornum = 3;
 194   2          SVPFirstHalfSector = deg > 150;
 195   2        }
 196   1        else if((deg >= 180) && (deg < 240))
 197   1        {
 198   2          sectornum = 4;
 199   2          SVPFirstHalfSector = deg < 210;
 200   2        }
 201   1        else if((deg >= 240) && (deg < 300))
 202   1        {
 203   2          sectornum = 5;
 204   2          SVPFirstHalfSector = deg > 270;
 205   2        }
 206   1        else if((deg >= 300) && (deg < 360))
 207   1        {
 208   2          sectornum = 6;
 209   2          SVPFirstHalfSector = deg < 330;
 210   2        }
 211   1      }
 212          
 213          void CalculateNextSpwmZoneTimeAndVector()
 214          {
 215   1        if(SVPWMCurrentZone < 2)
 216   1          SVPWMCurrentZone ++;
 217   1        else
 218   1          SVPWMCurrentZone = 0;
 219   1        if((SVPWMCurrentZone == 1))
 220   1        {
 221   2          if(SVPFirstHalfSector)
 222   2          {
 223   3            switch(sectornum)
 224   3            {
 225   4              case 1:
 226   4                NextTargetVector = 4;
 227   4                break;
 228   4              case 2:
 229   4                NextTargetVector = 2;
 230   4                break;
 231   4              case 3:
 232   4                NextTargetVector = 2;
 233   4                break;
 234   4              case 4:
 235   4                NextTargetVector = 1;
 236   4                break;
 237   4              case 5:
 238   4                NextTargetVector = 1;
 239   4                break;
 240   4              case 6:
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 5   

 241   4                NextTargetVector = 4;
 242   4                break;
 243   4            }
 244   3            NextSVPSectorTime = T1;
 245   3          }
 246   2          else
 247   2          {   
 248   3            switch(sectornum)
 249   3            {
 250   4              case 1:
 251   4                NextTargetVector = 6;
 252   4                break;
 253   4              case 2:
 254   4                NextTargetVector = 6;
 255   4                break;
 256   4              case 3:
 257   4                NextTargetVector = 3;
 258   4                break;
 259   4              case 4:
 260   4                NextTargetVector = 3;
 261   4                break;
 262   4              case 5:
 263   4                NextTargetVector = 5;
 264   4                break;
 265   4              case 6:
 266   4                NextTargetVector = 5;
 267   4                break;
 268   4            }
 269   3            NextSVPSectorTime = T2;
 270   3          }
 271   2        }
 272   1        else if((SVPWMCurrentZone == 2))
 273   1        {
 274   2          if(SVPFirstHalfSector)
 275   2          {
 276   3            switch(sectornum)
 277   3            {
 278   4              case 1:
 279   4                NextTargetVector = 6;
 280   4                break;
 281   4              case 2:
 282   4                NextTargetVector = 6;
 283   4                break;
 284   4              case 3:
 285   4                NextTargetVector = 3;
 286   4                break;
 287   4              case 4:
 288   4                NextTargetVector = 3;
 289   4                break;
 290   4              case 5:
 291   4                NextTargetVector = 5;
 292   4                break;
 293   4              case 6:
 294   4                NextTargetVector = 5;
 295   4                break;
 296   4            }
 297   3            NextSVPSectorTime = T2;
 298   3          }
 299   2          else
 300   2          {
 301   3            switch(sectornum)
 302   3            {
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 6   

 303   4              case 1:
 304   4                NextTargetVector = 4;
 305   4                break;
 306   4              case 2:
 307   4                NextTargetVector = 2;
 308   4                break;
 309   4              case 3:
 310   4                NextTargetVector = 2;
 311   4                break;
 312   4              case 4:
 313   4                NextTargetVector = 1;
 314   4                break;
 315   4              case 5:
 316   4                NextTargetVector = 1;
 317   4                break;
 318   4              case 6:
 319   4                NextTargetVector = 4;
 320   4                break;
 321   4            }
 322   3            NextSVPSectorTime = T1;
 323   3          }
 324   2        }
 325   1        else 
 326   1        {
 327   2          NextTargetVector = 0;
 328   2          NextSVPSectorTime = T07;
 329   2        }
 330   1        NextSVPSectorTime = ~NextSVPSectorTime;
 331   1      }
 332          
 333          unsigned int SwitchVector()
 334          {
 335   1        CurrentSVPSectorTime = NextSVPSectorTime;
 336   1        switch(NextTargetVector)
 337   1        {
 338   2          case 0:
 339   2            TurnOFF_HU;
 340   2            TurnOFF_HV;
 341   2            TurnOFF_HW;
 342   2            CalculateNextSpwmZoneTimeAndVector();
 343   2            TurnON_LU;
 344   2            TurnON_LV;
 345   2            TurnON_LW;
 346   2            break;
 347   2          case 7:
 348   2            TurnOFF_LU;
 349   2            TurnOFF_LV;
 350   2            TurnOFF_LW;
 351   2            CalculateNextSpwmZoneTimeAndVector();
 352   2            TurnON_HU;
 353   2            TurnON_HV;
 354   2            TurnON_HW;
 355   2            break;
 356   2          case 1: 
 357   2            TurnOFF_HU;
 358   2            TurnOFF_HV;
 359   2            TurnOFF_LW;
 360   2            CalculateNextSpwmZoneTimeAndVector();
 361   2            TurnON_LU;
 362   2            TurnON_LV;
 363   2            TurnON_HW;
 364   2            break;
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 7   

 365   2          case 2:
 366   2            TurnOFF_HU;
 367   2            TurnOFF_LV;
 368   2            TurnOFF_HW;
 369   2            CalculateNextSpwmZoneTimeAndVector();
 370   2            TurnON_LU;
 371   2            TurnON_HV;
 372   2            TurnON_LW;
 373   2            break;
 374   2          case 3:
 375   2            TurnOFF_HU;
 376   2            TurnOFF_LV;
 377   2            TurnOFF_LW;
 378   2            CalculateNextSpwmZoneTimeAndVector();
 379   2            TurnON_LU;
 380   2            TurnON_HV;
 381   2            TurnON_HW;
 382   2            break;
 383   2          case 4:
 384   2            TurnOFF_LU;
 385   2            TurnOFF_HV;
 386   2            TurnOFF_HW;
 387   2            CalculateNextSpwmZoneTimeAndVector();
 388   2            TurnON_HU;
 389   2            TurnON_LV;
 390   2            TurnON_LW;
 391   2            break;
 392   2          case 5:
 393   2            TurnOFF_LU;
 394   2            TurnOFF_HV;
 395   2            TurnOFF_LW;
 396   2            CalculateNextSpwmZoneTimeAndVector();
 397   2            TurnON_HU;
 398   2            TurnON_LV;
 399   2            TurnON_HW;
 400   2            break;
 401   2          case 6:
 402   2            TurnOFF_LU;
 403   2            TurnOFF_LV;
 404   2            TurnOFF_HW;
 405   2            CalculateNextSpwmZoneTimeAndVector();
 406   2            TurnON_HU;
 407   2            TurnON_HV;
 408   2            TurnON_LW;
 409   2            break;
 410   2          default:      
 411   2            CalculateNextSpwmZoneTimeAndVector();
 412   2            break;
 413   2        }
 414   1        return CurrentSVPSectorTime;
 415   1      }
 416          
 417          
 418          
 419          
 420          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    768    ----
   CONSTANT SIZE    =   1444    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   SVPWM                                                             08/26/2018 18:52:17 PAGE 8   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
